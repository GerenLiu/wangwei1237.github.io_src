---
title: 在解决问题之前首先要正确的定义问题
reward: false
top: false
date: 2021-09-16 10:18:34
authors:
categories:
  - 文化
tags:
  - 方法论
---

多年以前，我阅读了一本至今都让我受益匪浅的书：《你的灯亮着吗？》。在接下来的工作中，我总会按照书中的内容来训练自己解决工作中遇到的问题。作为一名测试开发工程师，在定位 BUG时，我甚至也会用到该书中介绍的问题解决思维模式。在这本书的第一章《这是谁的问题》中提到：

{% douban book 1135754 %}

> 初出茅庐的问题解决者总是在还没有定义好问题的时候就仓促的给出解决方案。迫于外界环境的压力，经验丰富的问题解决者有时也耐不住性子。在这种情况下，尽管他们能找到很多方法来解决问题，但是不一定对症。

我们一直在孜孜不倦的追求解决问题的方法、策略、妙招，却从来没有仔细想过，问题究竟是什么？

<!--more-->

## 缘起
工作中，经常会自己定位或者帮助同事定位各种各样的 BUG。有时候，BUG 会比较简单，而有时候遇到的 BUG 则相对复杂。在帮助同事定位 BUG 的时候，经常会遇到同事描述的问题和最后实际定位之后的问题并不一致的情况。

在问题定位中，我们要：大胆假设，小心求证。但是，我发现，好多人只做到了大胆假设，在定位 BUG 时，大胆假设了一个问题，然后在定位过程中就把这个大胆假设的问题当成了真正的问题，结果就是在定位 BUG 的道路上越走越迷糊……

每次说到这个的时候，大家普遍反馈：道理是这个道理，理论我们也都懂呀，但是就是做不到呀，怎么办呢？

“鉴于往事，有资于治道”。

为了能够让大家有比较真实的体验，我准备将自己工作中遇到的类似的问题进行梳理。在梳理的过程中，由于各种原因，我无法将原始问题涉及到的内容原样呈现，我需要对原始的问题进行一定的抽象。但是，对问题抽象并不会对问题的原貌和本质进行修改，并力求做到尽量保证问题的原样呈现。

## 为什么容器不能暴露服务的URI呢？
#### 问题背景
我们的 CI/CD 服务类似 [GitHub Actions](https://docs.github.com/en/actions)，当然和 GitHub Actions 的差异非常大（例如整个任务的编排机制、容器的底层机制、容器的托管机制……），但是使用起来是类似的。

![](actions-workflow.svg)

每当有对应的事件发生时（例如代码提交、代码合并等），就会触发一些列的自动化任务，例如代码编译、代码扫描、运行单元测试……。在执行这些自动化任务的时候，会首先分配一个容器（类似 [GitHub-hosted runners](https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners)），然后在该容器中执行在平台上配置好的任务。

![](workflow.gif)

有一天，我们团队需要一个功能：**开放容器中部署的 HTTP 服务，以便其他的容器可以通过 URL 来访问这个 HTTP 服务，因为这样的话就可以避免这个 HTTP 服务的多次部署（部署一次，然后供其他的多个任务来使用），从而提升效率。**

我安排了一个同事来解决这个问题。同事告诉我说，**从平台的配置上看，是有暴露容器PORT的功能的，但是这个功能目前没有实现，所以需要推动平台方实现这个功能。**

#### 问题的变化
不知道大家发现没有，到目前为止，这个案例中的问题已经发生了变化。问题从`在其他容器中访问另外容器中的 HTTP 服务` $\implies$ `CI/CD 平台方需要提供暴露容器 PORT 的能力`。

这个问题的转化看起来是多么的自然而又正常。接下来，为了实现我们的目标，我们和平台方组织了一个技术讨论会，专门讨论平台方何时可以实现**暴露容器 PORT**的功能。

经过和平台方的讨论，因为涉及到端口分配、端口冲突等端口管理问题，**暴露容器 PORT**这个功能短时间内无法实现。

讨论之后，我们发现，我们需要的功能看起来是无法实现了。不是吗？

#### 回归最原始的问题
在技术讨论的最后，我请教了平台方技术同学我们那个最原始的问题：如果我们想要在其他容器中访问另外容器中的 HTTP 服务，有什么可行的方案吗？

直到这个时候，我们才知道，原来我们容器中使用的 PORT 实际上就是物理机上的 PORT。我们可以直接时候用所分配的容器的 IP 和容器中启动的 HTTP 服务的端口来直接访问这个容器内的服务。

这时，我的同事说，之前用 `ifconfig` 命令拿到的 IP 和容器中启动的 HTTP 服务的 PORT 测试过，是没办法访问容器内的服务的。

到这里，我想我大概知道问题究竟出在哪里了。`ifconfig` 获取的是宿主机的网卡 IP 地址，而对于服务器而言，一般会有多个网卡，因此该命令会得到多个 IP 地址。而对于容器的 IP 地址，我们需要使用特定的指令才能够拿到正确的容器 IP。

最后，我们按照平台方的技术同学提供的方法完美的实现了我们所要的功能。

#### 从这个案例中，发现了什么？


## Nginx 为什么会自动抢占某个被释放的端口？


![](/waiting.gif)

如果您也有类似的案例，可以给本文提交 [ISSUE 评论](https://github.com/wangwei1237/wangwei1237.github.io/issues/314)，也可以在 [讨论区](https://github.com/wangwei1237/wangwei1237.github.io/discussions/317) 留下您的案例，还可以在下方的评论处留下您的案例，我也会将这些案例增加到文章之中。